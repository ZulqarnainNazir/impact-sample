- title 'Browse Missions'

= render partial: 'dashbreadcrumb', locals: { lnk: :businesses, fn: 'Marketing Missions', fp: :reminders, an: 'Browse Missions'}

.ibox
  .ibox-title
    h5 Browse Missions
    .ibox-tools
      a.user-dropdown-toggle[data-toggle="dropdown"]
        span
           small.text-muted
             i.fa.fa-edit
             |  Manage Missions
             span.caret.pull-right
      ul.dropdown-menu
        li
          = link_to 'Create New Mission', new_business_mission_instance_path(@business)
        li
          = link_to "View Active Missions", [@business, :reminders]
        li
          = link_to 'Manage Notifications', [:edit, @business, :mission_notifications]
  .ibox-content
    table.table.table-hover
      thead
        th Status
        th Title
        th Schedule
        th Completion
        th Assigned
        th Actions
      tbody
        - @missions.each do |mission|
          - instance = @mission_instances[mission.id]&.first

          - if instance && instance&.active?
            tr
              td
                span.label.label-primary Active
              td
                strong = link_to mission.title, business_mission_path(@business, mission)
                - if mission.globally_recommended
                  span.label.label-primary.m-l-1 Recommendation
                .small = "Added #{instance&.created_at&.strftime('%m/%d/%y')}"
              td
                - if instance && instance.scheduled?
                  a = instance.schedule.to_s
                  .small = "Next due: #{instance&.next_due_at&.strftime('%m/%d/%y')}"
                - else
                  a One time
                  .small = "Due: #{instance&.start_date&.strftime('%m/%d/%y')}"
              td = render partial: 'businesses/reminders/completion_rate', locals: { mission: mission }
              td = instance&.assigned_user&.name
              td = render partial: 'businesses/reminders/mission_actions', locals: { mission: mission }
          - else
            tr
              td
                span.label.label-default Inactive
              td
                strong = link_to mission.title, business_mission_path(@business, mission)
                - if mission.globally_recommended
                  span.label.label-primary.m-l-1 Recommendation
                .small Not yet added
              td
                a = mission.schedule ? mission.schedule.to_s : 'One time'
                .small Next due: N/A
              td = render partial: 'businesses/reminders/completion_rate', locals: { mission: mission }
              td N/A
              td
                = link_to activate_business_mission_instances_path(@business, mission_id: mission.id), method: :post, class: 'btn btn-primary btn-sm' do
                  i.fa.fa-check.m-r-5px
                  | Activate

    = paginate @missions


